# 開発経緯とトラブルシューティング

本ドキュメントは `gh-mutual-follow` の開発プロセスにおける初期設定、発生した問題、およびその解決策を記録するものです。

## 1. プロジェクト初期設定

-   `README.md` の読み込みとプロジェクト要件の理解
-   `internal/cli` および `internal/tui` ディレクトリの作成
-   `main.go`, `internal/cli/cli.go`, `internal/cli/cli_test.go` の初期ファイル作成
-   Go の依存関係（`bubbletea`, `lipgloss`, `bubbles/textarea` など）のインストール

## 2. 発生した問題と解決

開発中に発生した主な問題と、その対応履歴です。

-   **GitHub CLI未ログイン**:
    -   **問題**: `gh` コマンドが失敗する。
    -   **解決**: ユーザーに `gh auth login` の実行を促すことで解決。

-   **`go run main.go` の問題**:
    -   **問題**: 複数パッケージ構成のプロジェクトで `go run main.go` を実行すると、`main` パッケージ内の他ファイルのシンボルが見つからずエラーになる。
    -   **解決**: プロジェクトルートで `go run .` を使用するよう修正。

-   **構文エラー**:
    -   **問題**: `lipgloss` のメソッドチェーンの誤り、`Update` 関数内の括弧の不整合など、多数のGo構文エラーが発生。
    -   **解決**: コンパイラのエラーメッセージに基づき、都度修正。

-   **`isBulkActionInProgress` 状態管理のバグ**:
    -   **問題**: 一括アクションが完了した後も、状態をリセットするフラグが `false` に戻らず、UIが操作不能になる。
    -   **解決**: 一括処理の完了後に必ず状態をリセットするようロジックを修正。

-   **表示件数とレイアウトの崩れ**:
    -   **問題**: `bubbles/list` の表示件数がターミナルサイズに依存してしまい、意図した件数（10件）にならない。ページングも機能しない。
    -   **解決**: `gh api` に `--paginate` をつけて全件取得を確実にした上で、`list.SetHeight()` と `lipgloss.Height()` に試行錯誤で導き出した固定値を設定。これにより、レイアウトとページングが安定して機能するようになった。

-   **アクション実行時のエラー (権限不足)**:
    -   **問題**: ユーザーのフォロー/アンフォロー時にAPIエラーが発生する。
    -   **解決**: `runCommand` のエラー出力を詳細化し、原因がGitHub認証トークンのスコープ不足（`user` スコープの欠如）であることを特定。ユーザーに `gh auth refresh -h github.com -s user` の実行を指示し、解決。

以上の対応により、アプリケーションは現在の機能する状態に至りました。
